<script>
    //散团利润报表查看
    $(document).ready(function () {

        $("body").on("click", ".nav-tabs", function (){
            //加载订单
            $(".tab-content").find(".tab-pane.active table.ajax-list-table").each(function(key,row){
                ajaxSkTeamInfoData($(this));
            })

            //加载订单
            $(".tab-content").find(".tab-pane.active table.ajax-list-guide").each(function(key,row){
                ajaxSkTeamGuideInfoData($(this));
            })
            
        });
        
        //加载订单=》散协和
        $(".tab-content").find(".tab-pane table.ajax-list-table").each(function(key,row){
            ajaxSkTeamInfoData($(this));
        })

        //加载订单=>导游
        $(".tab-content").find(".tab-pane table.ajax-list-guide").each(function(key,row){
            ajaxSkTeamGuideInfoData($(this));
        })
        
        //ajaxSkTeamInfoData($(".tab-pane.active").find("table"));
        
        
    })

    //统计面板数据处理
    function ajaxUpdateTotalMoney() {

        revenue=$(".order_total_content td.revenue").find('label').html();

        guide=$(".order_total_content td.guide").find('label').html();

        driver=$(".order_total_content td.driver").find('label').html();

        signbill=$(".order_total_content td.signbill").find('label').html();

        expend=$(".order_total_content td.expend").find('label').html();

        store=$(".order_total_content td.store").find('label').html();

        in_money=parseFloat(revenue)+parseFloat(store);

        out_money=parseFloat(guide)+parseFloat(driver)+parseFloat(signbill)+parseFloat(expend);

        rtn_money=parseFloat(in_money)-parseFloat(out_money);
        
        $(".order_total_content .profit .in").find('label').html(parseFloat(in_money).toFixed(2));
        $(".order_total_content .profit .out").find('label').html(parseFloat(out_money).toFixed(2));
        $(".order_total_content .profit .rtn").find('label').html(parseFloat(rtn_money).toFixed(2));
    }

    //订单详细数据加载
    function  ajaxSkTeamInfoData(object){
        target=object.attr("data-url");
        //log(target);

        $.ajaxSettings.async = false;
        
        $.get(target).success(function (jsonData) {

            html=ajaxSkTeamInfoDataTpl(jsonData.data,jsonData.type);

            object.find("tbody").html(html);

            $(".order_total_content ."+jsonData.type).find('label').html(jsonData.total_money);
            
        },"json");
        
        $.ajaxSettings.async = true;
        
        //计算总金额
        ajaxUpdateTotalMoney();
        
    }
    

    //订单详细 导游报账
    function  ajaxSkTeamGuideInfoData(object){
        target=object.attr("data-url");
        
        //log(target);
        $.get(target).success(function (jsonData) {

            html=ajaxSkTeamGuideInfoDataTpl(jsonData.data,jsonData.type);//导游报账模板

            object.find("tbody").html(html);

        },"json");
    }
    

    //订单详细数据加载=》模板
    function  ajaxSkTeamInfoDataTpl(data,type){

        var html="";

        $.each(data,function(key,row){

            switch(type) {
                case 'signbill':
                    html +='<tr>';
                    html +='<td>'+row.sign_date+'</td>';
                    html +='<td>'+row.sign_no+'</td>';
                    html +='<td>'+row.restaurant_name+'</td>';
                    html +='<td>'+row.adult_num+'</td>';
                    html +='<td>'+row.adult_price+'</td>';
                    html +='<td>'+row.child_num+'</td>';
                    html +='<td>'+row.child_price+'</td>';
                    html +='<td>'+row.sibu_num+'</td>';
                    html +='<td>'+row.sibu_price+'</td>';
                    html +='<td>'+row.rebate+'</td>';
                    html +='<td>'+row.total_price+'</td>';
                    html +='<td>'+row.remark+'</td>';
                    html +='<td>';
                    html +='    <lqf_link><a class="ajax-open" data-url="{:url(\'SkTeamSignbill/edit\')}"  data-ids="{\'id\':\''+row.id+'\'}" data-title="修改" data-calback="ajaxSkTeamInfoData($(\'.ajax-list-table.signbill\'))">修改</a></lqf_link>';
                    html +='    <lqf_link><a class="ajax-del" data-url="{:url(\'SkTeamSignbill/del\')}"  data-ids="{\'id\':\''+row.id+'\'}"  data-calback="ajaxSkTeamInfoData($(\'.ajax-list-table.signbill\'))">删除</a></lqf_link>';
                    html +='</td>';
                    html +='</tr>';
                    break;
                case 'revenue':
                    html +='<tr>';
                    html +='<td>'+row.item_name+'</td>';
                    html +='<td>'+row.price+'</td>';
                    html +='<td>'+row.number+'</td>';
                    html +='<td>'+row.total_price+'</td>';
                    html +='<td>'+row.remark+'</td>';
                    html +='<td>';
                    html +='    <lqf_link><a class="ajax-open" data-url="{:url(\'SkTeamRevenue/edit\')}"  data-ids="{\'id\':\''+row.id+'\'}" data-title="修改" data-calback="ajaxSkTeamInfoData($(\'.ajax-list-table.revenue\'))">修改</a></lqf_link>';
                    html +='    <lqf_link><a class="ajax-del" data-url="{:url(\'SkTeamRevenue/del\')}"  data-ids="{\'id\':\''+row.id+'\'}"  data-calback="ajaxSkTeamInfoData($(\'.ajax-list-table.revenue\'))">删除</a></lqf_link>';
                    html +='</td>';
                    html +='</tr>';
                    break;
                case 'expend':
                    html +='<tr>';
                    html +='<td>'+row.item_name+'</td>';
                    html +='<td>'+row.price+'</td>';
                    html +='<td>'+row.number+'</td>';
                    html +='<td>'+row.total_price+'</td>';
                    html +='<td>'+row.remark+'</td>';
                    html +='<td>';
                    html +='    <lqf_link><a class="ajax-open" data-url="{:url(\'SkTeamExpend/edit\')}"  data-ids="{\'id\':\''+row.id+'\'}" data-title="修改" data-calback="ajaxSkTeamInfoData($(\'.ajax-list-table.expend\'))">修改</a></lqf_link>';
                    html +='    <lqf_link><a class="ajax-del" data-url="{:url(\'SkTeamExpend/del\')}"  data-ids="{\'id\':\''+row.id+'\'}"  data-calback="ajaxSkTeamInfoData($(\'.ajax-list-table.expend\'))">删除</a></lqf_link>';
                    html +='</td>';
                    html +='</tr>';
                    break;
                case 'store':
                    html +='<tr>';
                    html +='<td>'+row.store_name+'</td>';
                    html +='<td>'+row.price+'</td>';
                    html +='<td>'+row.into_num+'</td>';
                    html +='<td>'+row.fill_num+'</td>';
                    html +='<td>'+row.total_price+'</td>';
                    html +='<td>'+row.flow_money+'</td>';
                    html +='<td>'+row.rebate+'</td>';
                    html +='<td>'+row.rebate_money+'</td>';
                    html +='<td>'+row.total_money+'</td>';
                    html +='<td>'+row.remark+'</td>';
                    html +='<td>';
                    html +='    <lqf_link><a class="ajax-open" data-url="{:url(\'SkTeamStore/edit\')}"  data-ids="{\'id\':\''+row.id+'\'}" data-title="修改" data-calback="ajaxSkTeamInfoData($(\'.ajax-list-table.store\'))">修改</a></lqf_link>';
                    html +='    <lqf_link><a class="ajax-del" data-url="{:url(\'SkTeamStore/del\')}"  data-ids="{\'id\':\''+row.id+'\'}"  data-calback="ajaxSkTeamInfoData($(\'.ajax-list-table.store\'))">删除</a></lqf_link>';
                    html +='</td>';
                    html +='</tr>';
                    break;
                case 'head':
                    html +='<tr>';
                    html +='<td>'+row.store_name+'</td>';
                    html +='<td>'+row.price+'</td>';
                    html +='<td>'+row.into_num+'</td>';
                    html +='<td>'+row.fill_num+'</td>';
                    html +='<td>'+row.total_price+'</td>';
                    html +='<td>'+row.normal_money+'</td>';
                    html +='<td>'+row.normal_rebate+'</td>';
                    html +='<td>'+row.special_money+'</td>';
                    html +='<td>'+row.special_rebate+'</td>';
                    html +='<td>'+row.flow_money+'</td>';
                    html +='<td>'+row.rebate_money+'</td>';
                    html +='<td>'+row.guide_already_money+'</td>';
                    html +='<td>'+row.guide_divide_money+'</td>';
                    html +='<td>'+row.total_money+'</td>';
                    html +='<td>'+row.remark+'</td>';
                    html +='<td>';
                    html +='    <lqf_link><a class="ajax-open" data-url="{:url(\'SkGuideHead/edit\')}"  data-ids="{\'id\':\''+row.id+'\'}" data-title="修改" data-calback="ajaxSkTeamInfoData($(\'.ajax-list-table.head\'))">修改</a></lqf_link>';
                    html +='    <lqf_link><a class="ajax-del" data-url="{:url(\'SkGuideHead/del\')}"  data-ids="{\'id\':\''+row.id+'\'}"  data-calback="ajaxSkTeamInfoData($(\'.ajax-list-table.head\'))">删除</a></lqf_link>';
                    html +='</td>';
                    html +='</tr>';
                    break;
                default:
                    html="";
            }
            
        });
        
        return html
    }


    //订单详细数据加载=》导游报账模板
    function  ajaxSkTeamGuideInfoDataTpl(data,type){

        var html="";

        $.each(data,function(key,row){

            switch(type) {
                case 'fare':
                    html +='<tr>';
                    html +='<td>'+row.guide_name+'</td>';
                    html +='<td>'+row.driver_name+'</td>';
                    html +='<td>'+row.money+'</td>';
                    html +='<td>'+row.remark+'</td>';
                    html +='<td>';
                    html +='    <lqf_link><a class="ajax-open" data-url="{:url(\'SkGuideFare/edit\')}"  data-ids="{\'id\':\''+row.id+'\'}" data-title="修改" data-calback="ajaxSkTeamGuideInfoData($(\'.ajax-list-guide.fare\'))">修改</a></lqf_link>';
                    html +='    <lqf_link><a class="ajax-del" data-url="{:url(\'SkGuideFare/del\')}"  data-ids="{\'id\':\''+row.id+'\'}"  data-calback="ajaxSkTeamGuideInfoData($(\'.ajax-list-guide.fare\'))">删除</a></lqf_link>';
                    html +='</td>';
                    html +='</tr>';
                    break;
                case 'food':
                    html +='<tr>';
                    html +='<td>'+row.guide_name+'</td>';
                    html +='<td>'+row.restaurant_name+'</td>';
                    html +='<td>'+row.adult_num+'</td>';
                    html +='<td>'+row.adult_price+'</td>';
                    html +='<td>'+row.child_num+'</td>';
                    html +='<td>'+row.child_price+'</td>';
                    html +='<td>'+row.total_price+'</td>';
                    html +='<td>'+row.remark+'</td>';
                    html +='<td>';
                    html +='    <lqf_link><a class="ajax-open" data-url="{:url(\'SkGuideFood/edit\')}"  data-ids="{\'id\':\''+row.id+'\'}" data-title="修改" data-calback="ajaxSkTeamGuideInfoData($(\'.ajax-list-guide.food\'))">修改</a></lqf_link>';
                    html +='    <lqf_link><a class="ajax-del" data-url="{:url(\'SkGuideFood/del\')}"  data-ids="{\'id\':\''+row.id+'\'}"  data-calback="ajaxSkTeamGuideInfoData($(\'.ajax-list-guide.food\'))">删除</a></lqf_link>';
                    html +='</td>';
                    html +='</tr>';
                    break;
                case 'scenic':
                    html +='<tr>';
                    html +='<td>'+row.guide_name+'</td>';
                    html +='<td>'+row.scenic_name+'</td>';
                    html +='<td>'+row.aged_num+'</td>';
                    html +='<td>'+row.aged_price+'</td>';
                    html +='<td>'+row.adult_num+'</td>';
                    html +='<td>'+row.adult_price+'</td>';
                    html +='<td>'+row.child_num+'</td>';
                    html +='<td>'+row.child_price+'</td>';
                    html +='<td>'+row.total_price+'</td>';
                    html +='<td>'+row.remark+'</td>';
                    html +='<td>';
                    html +='    <lqf_link><a class="ajax-open" data-url="{:url(\'SkGuideScenic/edit\')}"  data-ids="{\'id\':\''+row.id+'\'}" data-title="修改" data-calback="ajaxSkTeamGuideInfoData($(\'.ajax-list-guide.scenic\'))">修改</a></lqf_link>';
                    html +='    <lqf_link><a class="ajax-del" data-url="{:url(\'SkGuideScenic/del\')}"  data-ids="{\'id\':\''+row.id+'\'}"  data-calback="ajaxSkTeamGuideInfoData($(\'.ajax-list-guide.scenic\'))">删除</a></lqf_link>';
                    html +='</td>';
                    html +='</tr>';
                    break;
                case 'head':
                    html +='<tr>';
                    html +='<td>'+row.guide_name+'</td>';
                    html +='<td>'+row.store_name+'</td>';
                    html +='<td>'+row.price+'</td>';
                    html +='<td>'+row.into_num+'</td>';
                    html +='<td>'+row.fill_num+'</td>';
                    html +='<td>'+row.total_price+'</td>';
                    html +='<td>'+row.normal_money+'</td>';
                    html +='<td>'+row.normal_rebate+'</td>';
                    html +='<td>'+row.special_money+'</td>';
                    html +='<td>'+row.special_rebate+'</td>';
                    html +='<td>'+row.flow_money+'</td>';
                    html +='<td>'+row.rebate_money+'</td>';
                    html +='<td>'+row.guide_already_money+'</td>';
                    html +='<td>'+row.guide_divide_money+'</td>';
                    html +='<td>'+row.total_money+'</td>';
                    html +='<td>'+row.remark+'</td>';
                    html +='<td>';
                    html +='    <lqf_link><a class="ajax-open" data-url="{:url(\'SkGuideHead/edit\')}"  data-ids="{\'id\':\''+row.id+'\'}" data-title="修改" data-calback="ajaxSkTeamGuideInfoData($(\'.ajax-list-guide.head\'))">修改</a></lqf_link>';
                    html +='    <lqf_link><a class="ajax-del" data-url="{:url(\'SkGuideHead/del\')}"  data-ids="{\'id\':\''+row.id+'\'}"  data-calback="ajaxSkTeamGuideInfoData($(\'.ajax-list-guide.head\'))">删除</a></lqf_link>';
                    html +='</td>';
                    html +='</tr>';
                    break;
                case 'travel':
                    html +='<tr>';
                    html +='<td>'+row.guide_name+'</td>';
                    html +='<td>'+row.item_travel_name+'</td>';
                    html +='<td>'+row.price+'</td>';
                    html +='<td>'+row.number+'</td>';
                    html +='<td>'+row.total_price+'</td>';
                    html +='<td>'+row.remark+'</td>';
                    html +='<td>';
                    html +='    <lqf_link><a class="ajax-open" data-url="{:url(\'SkGuideTravel/edit\')}"  data-ids="{\'id\':\''+row.id+'\'}" data-title="修改" data-calback="ajaxSkTeamGuideInfoData($(\'.ajax-list-guide.travel\'))">修改</a></lqf_link>';
                    html +='    <lqf_link><a class="ajax-del" data-url="{:url(\'SkGuideTravel/del\')}"  data-ids="{\'id\':\''+row.id+'\'}"  data-calback="ajaxSkTeamGuideInfoData($(\'.ajax-list-guide.travel\'))">删除</a></lqf_link>';
                    html +='</td>';
                    html +='</tr>';
                    break;
                case 'receipt':
                    html +='<tr>';
                    html +='<td>'+row.guide_name+'</td>';
                    html +='<td>'+row.item_receipt_name+'</td>';
                    html +='<td>'+row.adult_num+'</td>';
                    html +='<td>'+row.adult_price+'</td>';
                    html +='<td>'+row.child_num+'</td>';
                    html +='<td>'+row.child_price+'</td>';
                    html +='<td>'+row.total_price+'</td>';
                    html +='<td>'+row.remark+'</td>';
                    html +='<td>';
                    html +='    <lqf_link><a class="ajax-open" data-url="{:url(\'SkGuideReceipt/edit\')}"  data-ids="{\'id\':\''+row.id+'\'}" data-title="修改" data-calback="ajaxSkTeamGuideInfoData($(\'.ajax-list-guide.receipt\'))">修改</a></lqf_link>';
                    html +='    <lqf_link><a class="ajax-del" data-url="{:url(\'SkGuideReceipt/del\')}"  data-ids="{\'id\':\''+row.id+'\'}"  data-calback="ajaxSkTeamGuideInfoData($(\'.ajax-list-guide.receipt\'))">删除</a></lqf_link>';
                    html +='</td>';
                    html +='</tr>';
                    break;
                case 'paid':
                    html +='<tr>';
                    html +='<td>'+row.guide_name+'</td>';
                    html +='<td>'+row.item_name+'</td>';
                    html +='<td>'+row.money+'</td>';
                    html +='<td>'+row.remark+'</td>';
                    html +='<td>';
                    html +='    <lqf_link><a class="ajax-open" data-url="{:url(\'SkGuidePaid/edit\')}"  data-ids="{\'id\':\''+row.id+'\'}" data-title="修改" data-calback="ajaxSkTeamGuideInfoData($(\'.ajax-list-guide.paid\'))">修改</a></lqf_link>';
                    html +='    <lqf_link><a class="ajax-del" data-url="{:url(\'SkGuidePaid/del\')}"  data-ids="{\'id\':\''+row.id+'\'}"  data-calback="ajaxSkTeamGuideInfoData($(\'.ajax-list-guide.paid\'))">删除</a></lqf_link>';
                    html +='</td>';
                    html +='</tr>';
                    break;
                case 'coll':
                    html +='<tr>';
                    html +='<td>'+row.guide_name+'</td>';
                    html +='<td>'+row.item_name+'</td>';
                    html +='<td>'+row.money+'</td>';
                    html +='<td>'+row.remark+'</td>';
                    html +='<td>';
                    html +='    <lqf_link><a class="ajax-open" data-url="{:url(\'SkGuideColl/edit\')}"  data-ids="{\'id\':\''+row.id+'\'}" data-title="修改" data-calback="ajaxSkTeamGuideInfoData($(\'.ajax-list-guide.coll\'))">修改</a></lqf_link>';
                    html +='    <lqf_link><a class="ajax-del" data-url="{:url(\'SkGuideColl/del\')}"  data-ids="{\'id\':\''+row.id+'\'}"  data-calback="ajaxSkTeamGuideInfoData($(\'.ajax-list-guide.coll\'))">删除</a></lqf_link>';
                    html +='</td>';
                    html +='</tr>';
                    break;
                default:
                    html="";
            }

        });

        return html
    }


</script>