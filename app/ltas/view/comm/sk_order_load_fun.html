<script>
    // 散客订单报账列表加载

    $(document).ready(function () {
        $("body").on("click", ".nav-tabs", function (){
            $(".tab-content").find(".tab-pane.active table.ajax-list-table").each(function(key,row){
                ajaxSkOrderInfoData($(this));
            });

            $(".tab-content").find(".tab-pane.active table.ajax-list-guide").each(function(key,row){
                ajaxSkOrderGuideInfoData($(this));
            });
            
        });
        $(".tab-content").find(".tab-pane table.ajax-list-table").each(function(key,row){
            ajaxSkOrderInfoData($(this));
        })

        $(".tab-content").find(".tab-pane table.ajax-list-guide").each(function(key,row){

            ajaxSkOrderGuideInfoData($(this));
        })
        
        //ajaxSkOrderInfoData($(".tab-pane.active").find("table"));
        
        
    })

    //统计面板数据处理
    function ajaxUpdateTotalMoney() {

        rece=$(".order_total_content td.rece").find('label').html();
        revenue=$(".order_total_content td.revenue").find('label').html();
        refund=$(".order_total_content td.refund").find('label').html();

        guide=$(".order_total_content td.guide").find('label').html();
        hotel=$(".order_total_content td.hotel").find('label').html();
        driver=$(".order_total_content td.driver").find('label').html();
        buy=$(".order_total_content td.buy").find('label').html();
        signbill=$(".order_total_content td.signbill").find('label').html();
        expend=$(".order_total_content td.expend").find('label').html();

        in_money=parseFloat(rece)+parseFloat(revenue)+parseFloat(refund);
log('inmoney'+in_money);
        out_money=parseFloat(guide)+parseFloat(hotel)+parseFloat(driver)+parseFloat(buy)+parseFloat(signbill)+parseFloat(expend);

        rtn_money=parseFloat(in_money)-parseFloat(out_money);

        $(".order_total_content .profit .in").find('label').html(parseFloat(in_money).toFixed(2));
        $(".order_total_content .profit .out").find('label').html(parseFloat(out_money).toFixed(2));
        $(".order_total_content .profit .rtn").find('label').html(parseFloat(rtn_money).toFixed(2));
    }

    //订单详细数据加载
    function  ajaxSkOrderInfoData(object){
        target=object.attr("data-url");
        log(target);
        $.ajaxSettings.async = false;
        $.get(target).success(function (jsonData) {

            html=ajaxSkOrderInfoDataTpl(jsonData.data,jsonData.type);

            object.find("tbody").html(html);

            $(".order_total_content ."+jsonData.type).find('label').html(jsonData.total_money);
            
        },"json");

        $.ajaxSettings.async = true;

        //计算总金额
        ajaxUpdateTotalMoney();
        
    }
    //订单详细 导游报账
    function  ajaxSkOrderGuideInfoData(object){
        target=object.attr("data-url");
        log(target);
        $.get(target).success(function (jsonData) {

            html=ajaxSkOrderGuideInfoDataTpl(jsonData.data,jsonData.type);//导游报账模板

            object.find("tbody").html(html);

        },"json");
    }

    //订单详细数据加载
    function  ajaxSkOrderInfoDataTpl(data,type){

        var html="";

        $.each(data,function(key,row){
            switch(type) {
                case 'rece':
                    html +='<tr>';
                    html +='<td>'+row.adult_price+'</td>';
                    html +='<td>'+row.adult_num+'</td>';
                    html +='<td>'+row.child_car_price+'</td>';
                    html +='<td>'+row.child_car_num+'</td>';
                    html +='<td>'+row.child_ticket_price+'</td>';
                    html +='<td>'+row.child_ticket_num+'</td>';
                    html +='<td>'+row.other_price+'</td>';
                    html +='<td>'+row.other_num+'</td>';
                    html +='<td>'+row.rebate+'</td>';
                    html +='<td>'+row.total_price+'</td>';
                    html +='<td>'+row.remark+'</td>';
                    html +='<td>';
                    html +='    <lqf_link><a class="ajax-open" data-url="{:url(\'SkOrderRece/edit\')}"  data-ids="{\'id\':\''+row.id+'\'}" data-title="修改" data-calback="ajaxSkOrderInfoData($(\'.ajax-list-table.rece\'))">修改</a></lqf_link>';
                    html +='    <lqf_link><a class="ajax-del" data-url="{:url(\'SkOrderRece/del\')}"  data-ids="{\'id\':\''+row.id+'\'}"  data-calback="ajaxSkOrderInfoData($(\'.ajax-list-table.rece\'))">删除</a></lqf_link>';
                    html +='</td>';
                    html +='</tr>';
                    break;
                case 'trust':
                    html +='<tr>';
                    html +='<td>'+row.item_name+'</td>';
                    html +='<td>'+row.price+'</td>';
                    html +='<td>'+row.number+'</td>';
                    html +='<td>'+row.total_price+'</td>';
                    html +='<td>'+row.remark+'</td>';
                    html +='<td>';
                    html +='    <lqf_link><a class="ajax-open" data-url="{:url(\'SkOrderTrust/edit\')}"  data-ids="{\'id\':\''+row.id+'\'}" data-title="修改" data-calback="ajaxSkOrderInfoData($(\'.ajax-list-table.trust\'))">修改</a></lqf_link>';
                    html +='    <lqf_link><a class="ajax-del" data-url="{:url(\'SkOrderTrust/del\')}"  data-ids="{\'id\':\''+row.id+'\'}"  data-calback="ajaxSkOrderInfoData($(\'.ajax-list-table.trust\'))">删除</a></lqf_link>';
                    html +='</td>';
                    html +='</tr>';
                    break;
                case 'guide':
                    html +='<tr>';
                    html +='<td>'+row.trip_date+'</td>';
                    html +='<td>'+row.guide_name+'</td>';
                    html +='<td>'+row.guide_price+'</td>';
                    html +='<td>'+row.guide_payable+'</td>';
                    html +='<td>'+row.remark+'</td>';
                    html +='<td>';
                    html +='</td>';
                    html +='</tr>';
                    break;
                case 'driver':
                    html +='<tr>';
                    html +='<td>'+row.driver_date+'</td>';
                    html +='<td>'+row.driver_name+'</td>';
                    html +='<td>'+row.driver_fee+'</td>';
                    html +='<td>'+row.type+'</td>';
                    html +='<td>'+row.remark+'</td>';
                    html +='<td>';
                    html +='    <lqf_link><a class="ajax-open" data-url="{:url(\'SkOrderDriver/edit\')}"  data-ids="{\'id\':\''+row.id+'\'}" data-title="修改" data-calback="ajaxSkOrderInfoData($(\'.ajax-list-table.driver\'))">修改</a></lqf_link>';
                    html +='    <lqf_link><a class="ajax-del" data-url="{:url(\'SkOrderDriver/del\')}"  data-ids="{\'id\':\''+row.id+'\'}"  data-calback="ajaxSkOrderInfoData($(\'.ajax-list-table.driver\'))">确认</a></lqf_link>';
                    html +='</td>';
                    html +='</tr>';
                    break;
                case 'hotel':
                    html +='<tr>';
                    html +='<td>'+row.hotel_date+'</td>';
                    html +='<td>'+row.hotel_name+'</td>';
                    html +='<td>'+row.price+'</td>';
                    html +='<td>'+row.number+'</td>';
                    html +='<td>'+row.total_price+'</td>';
                    html +='<td>'+row.remark+'</td>';
                    html +='<td>';
                    html +='    <lqf_link><a class="ajax-open" data-url="{:url(\'SkOrderHotel/edit\')}"  data-ids="{\'id\':\''+row.id+'\'}" data-title="修改" data-calback="ajaxSkOrderInfoData($(\'.ajax-list-table.hotel\'))">修改</a></lqf_link>';
                    html +='    <lqf_link><a class="ajax-del" data-url="{:url(\'SkOrderHotel/del\')}"  data-ids="{\'id\':\''+row.id+'\'}"  data-calback="ajaxSkOrderInfoData($(\'.ajax-list-table.hotel\'))">确认</a></lqf_link>';
                    html +='</td>';
                    html +='</tr>';
                    break;
                case 'buy':
                    html +='<tr>';
                    html +='<td>'+row.destination+'</td>';
                    html +='<td>'+row.train_name+'</td>';
                    html +='<td>'+row.train_type+'</td>';
                    html +='<td>'+row.number+'</td>';
                    html +='<td>'+row.price+'</td>';
                    html +='<td>'+row.total_price+'</td>';
                    html +='<td>'+row.ticket_time+'</td>';
                    html +='<td>'+row.idcards+'</td>';
                    html +='<td>'+row.ticket_name+'</td>';
                    html +='<td>'+row.remark+'</td>';
                    html +='<td>';
                    html +='    <lqf_link><a class="ajax-open" data-url="{:url(\'SkOrderTicketBuy/edit\')}"  data-ids="{\'id\':\''+row.id+'\'}" data-title="修改" data-calback="ajaxSkOrderInfoData($(\'.ajax-list-table.buy\'))">修改</a></lqf_link>';
                    html +='    <lqf_link><a class="ajax-del" data-url="{:url(\'SkOrderTicketBuy/del\')}"  data-ids="{\'id\':\''+row.id+'\'}"  data-calback="ajaxSkOrderInfoData($(\'.ajax-list-table.buy\'))">删除</a></lqf_link>';
                    html +='</td>';
                    html +='</tr>';
                    break;
                case 'refund':
                    html +='<tr>';
                    html +='<td>'+row.destination+'</td>';
                    html +='<td>'+row.train_name+'</td>';
                    html +='<td>'+row.train_type+'</td>';
                    html +='<td>'+row.number+'</td>';
                    html +='<td>'+row.loss_fee+'</td>';
                    html +='<td>'+row.total_loss_fee+'</td>';
                    html +='<td>'+row.cost+'</td>';
                    html +='<td>'+row.refund_fee+'</td>';
                    html +='<td>'+row.ticket_date+'</td>';
                    html +='<td>'+row.ticket_name+'</td>';
                    html +='<td>'+row.remark+'</td>';
                    html +='<td>';
                    html +='    <lqf_link><a class="ajax-open" data-url="{:url(\'SkOrderTicketRefund/edit\')}"  data-ids="{\'id\':\''+row.id+'\'}" data-title="修改" data-calback="ajaxSkOrderInfoData($(\'.ajax-list-table.refund\'))">修改</a></lqf_link>';
                    html +='    <lqf_link><a class="ajax-del" data-url="{:url(\'SkOrderTicketRefund/del\')}"  data-ids="{\'id\':\''+row.id+'\'}"  data-calback="ajaxSkOrderInfoData($(\'.ajax-list-table.refund\'))">删除</a></lqf_link>';
                    html +='</td>';
                    html +='</tr>';
                    break;
                case 'signbill':
                    html +='<tr>';
                    html +='<td>'+row.sign_date+'</td>';
                    html +='<td>'+row.sign_no+'</td>';
                    html +='<td>'+row.restaurant_name+'</td>';
                    html +='<td>'+row.item_name+'</td>';
                    html +='<td>'+row.adult_num+'</td>';
                    html +='<td>'+row.adult_price+'</td>';
                    html +='<td>'+row.child_num+'</td>';
                    html +='<td>'+row.child_price+'</td>';
                    html +='<td>'+row.rebate+'</td>';
                    html +='<td>'+row.total_price+'</td>';
                    html +='<td>'+row.remark+'</td>';
                    html +='<td>';
                    html +='    <lqf_link><a class="ajax-open" data-url="{:url(\'SkOrderSignbill/edit\')}"  data-ids="{\'id\':\''+row.id+'\'}" data-title="修改" data-calback="ajaxSkOrderInfoData($(\'.ajax-list-table.signbill\'))">修改</a></lqf_link>';
                    html +='    <lqf_link><a class="ajax-del" data-url="{:url(\'SkOrderSignbill/del\')}"  data-ids="{\'id\':\''+row.id+'\'}"  data-calback="ajaxSkOrderInfoData($(\'.ajax-list-table.signbill\'))">删除</a></lqf_link>';
                    html +='</td>';
                    html +='</tr>';
                    break;
                case 'revenue':
                    html +='<tr>';
                    html +='<td>'+row.item_name+'</td>';
                    html +='<td>'+row.price+'</td>';
                    html +='<td>'+row.number+'</td>';
                    html +='<td>'+row.total_price+'</td>';
                    html +='<td>'+row.remark+'</td>';
                    html +='<td>';
                    html +='    <lqf_link><a class="ajax-open" data-url="{:url(\'SkOrderRevenue/edit\')}"  data-ids="{\'id\':\''+row.id+'\'}" data-title="修改" data-calback="ajaxSkOrderInfoData($(\'.ajax-list-table.revenue\'))">修改</a></lqf_link>';
                    html +='    <lqf_link><a class="ajax-del" data-url="{:url(\'SkOrderRevenue/del\')}"  data-ids="{\'id\':\''+row.id+'\'}"  data-calback="ajaxSkOrderInfoData($(\'.ajax-list-table.revenue\'))">删除</a></lqf_link>';
                    html +='</td>';
                    html +='</tr>';
                    break;
                case 'expend':
                    html +='<tr>';
                    html +='<td>'+row.item_name+'</td>';
                    html +='<td>'+row.price+'</td>';
                    html +='<td>'+row.number+'</td>';
                    html +='<td>'+row.total_price+'</td>';
                    html +='<td>'+row.remark+'</td>';
                    html +='<td>';
                    html +='    <lqf_link><a class="ajax-open" data-url="{:url(\'SkOrderExpend/edit\')}"  data-ids="{\'id\':\''+row.id+'\'}" data-title="修改" data-calback="ajaxSkOrderInfoData($(\'.ajax-list-table.expend\'))">修改</a></lqf_link>';
                    html +='    <lqf_link><a class="ajax-del" data-url="{:url(\'SkOrderExpend/del\')}"  data-ids="{\'id\':\''+row.id+'\'}"  data-calback="ajaxSkOrderInfoData($(\'.ajax-list-table.expend\'))">删除</a></lqf_link>';
                    html +='</td>';
                    html +='</tr>';
                    break;
                default:
                    html="";
            }
            
        });
        
        return html
    }

    //订单详细数据加载=》导游报账模板
    function  ajaxSkOrderGuideInfoDataTpl(data,type){

        var html="";

        $.each(data,function(key,row){

            switch(type) {
                case 'fare':
                    html +='<tr>';
                    html +='<td>'+row.guide_name+'</td>';
                    html +='<td>'+row.driver_name+'</td>';
                    html +='<td>'+row.money+'</td>';
                    html +='<td>'+row.remark+'</td>';
                    html +='<td>';
                    html +='    <lqf_link><a class="ajax-open" data-url="{:url(\'TmGuideFare/edit\')}"  data-ids="{\'id\':\''+row.id+'\'}" data-title="修改" data-calback="ajaxTmOrderGuideInfoData($(\'.ajax-list-guide.fare\'))">修改</a></lqf_link>';
                    html +='    <lqf_link><a class="ajax-del" data-url="{:url(\'TmGuideFare/del\')}"  data-ids="{\'id\':\''+row.id+'\'}"  data-calback="ajaxTmOrderGuideInfoData($(\'.ajax-list-guide.fare\'))">删除</a></lqf_link>';
                    html +='</td>';
                    html +='</tr>';
                    break;
                case 'food':
                    html +='<tr>';
                    html +='<td>'+row.guide_name+'</td>';
                    html +='<td>'+row.dining_std_name+'</td>';
                    html +='<td>'+row.adult_num+'</td>';
                    html +='<td>'+row.adult_price+'</td>';
                    html +='<td>'+row.child_num+'</td>';
                    html +='<td>'+row.child_price+'</td>';
                    html +='<td>'+row.total_price+'</td>';
                    html +='<td>'+row.remark+'</td>';
                    html +='<td>';
                    html +='    <lqf_link><a class="ajax-open" data-url="{:url(\'TmGuideFood/edit\')}"  data-ids="{\'id\':\''+row.id+'\'}" data-title="修改" data-calback="ajaxTmOrderGuideInfoData($(\'.ajax-list-guide.food\'))">修改</a></lqf_link>';
                    html +='    <lqf_link><a class="ajax-del" data-url="{:url(\'TmGuideFood/del\')}"  data-ids="{\'id\':\''+row.id+'\'}"  data-calback="ajaxTmOrderGuideInfoData($(\'.ajax-list-guide.food\'))">删除</a></lqf_link>';
                    html +='</td>';
                    html +='</tr>';
                    break;
                case 'scenic':
                    html +='<tr>';
                    html +='<td>'+row.guide_name+'</td>';
                    html +='<td>'+row.scenic_name+'</td>';
                    html +='<td>'+row.aged_num+'</td>';
                    html +='<td>'+row.aged_price+'</td>';
                    html +='<td>'+row.adult_num+'</td>';
                    html +='<td>'+row.adult_price+'</td>';
                    html +='<td>'+row.child_num+'</td>';
                    html +='<td>'+row.child_price+'</td>';
                    html +='<td>'+row.total_price+'</td>';
                    html +='<td>'+row.remark+'</td>';
                    html +='<td>';
                    html +='    <lqf_link><a class="ajax-open" data-url="{:url(\'TmGuideScenic/edit\')}"  data-ids="{\'id\':\''+row.id+'\'}" data-title="修改" data-calback="ajaxTmOrderGuideInfoData($(\'.ajax-list-guide.scenic\'))">修改</a></lqf_link>';
                    html +='    <lqf_link><a class="ajax-del" data-url="{:url(\'TmGuideScenic/del\')}"  data-ids="{\'id\':\''+row.id+'\'}"  data-calback="ajaxTmOrderGuideInfoData($(\'.ajax-list-guide.scenic\'))">删除</a></lqf_link>';
                    html +='</td>';
                    html +='</tr>';
                    break;
                case 'head':
                    html +='<tr>';
                    html +='<td>'+row.guide_name+'</td>';
                    html +='<td>'+row.store_name+'</td>';
                    html +='<td>'+row.price+'</td>';
                    html +='<td>'+row.into_num+'</td>';
                    html +='<td>'+row.fill_num+'</td>';
                    html +='<td>'+row.total_price+'</td>';
                    html +='<td>'+row.flow_money+'</td>';
                    html +='<td>'+row.remark+'</td>';
                    html +='<td>';
                    html +='    <lqf_link><a class="ajax-open" data-url="{:url(\'TmGuideHead/edit\')}"  data-ids="{\'id\':\''+row.id+'\'}" data-title="修改" data-calback="ajaxTmOrderGuideInfoData($(\'.ajax-list-guide.head\'))">修改</a></lqf_link>';
                    html +='    <lqf_link><a class="ajax-del" data-url="{:url(\'TmGuideHead/del\')}"  data-ids="{\'id\':\''+row.id+'\'}"  data-calback="ajaxTmOrderGuideInfoData($(\'.ajax-list-guide.head\'))">删除</a></lqf_link>';
                    html +='</td>';
                    html +='</tr>';
                    break;
                case 'travel':
                    html +='<tr>';
                    html +='<td>'+row.guide_name+'</td>';
                    html +='<td>'+row.item_travel_name+'</td>';
                    html +='<td>'+row.price+'</td>';
                    html +='<td>'+row.number+'</td>';
                    html +='<td>'+row.total_price+'</td>';
                    html +='<td>'+row.remark+'</td>';
                    html +='<td>';
                    html +='    <lqf_link><a class="ajax-open" data-url="{:url(\'TmGuideTravel/edit\')}"  data-ids="{\'id\':\''+row.id+'\'}" data-title="修改" data-calback="ajaxTmOrderGuideInfoData($(\'.ajax-list-guide.travel\'))">修改</a></lqf_link>';
                    html +='    <lqf_link><a class="ajax-del" data-url="{:url(\'TmGuideTravel/del\')}"  data-ids="{\'id\':\''+row.id+'\'}"  data-calback="ajaxTmOrderGuideInfoData($(\'.ajax-list-guide.travel\'))">删除</a></lqf_link>';
                    html +='</td>';
                    html +='</tr>';
                    break;
                case 'receipt':
                    html +='<tr>';
                    html +='<td>'+row.guide_name+'</td>';
                    html +='<td>'+row.item_receipt_name+'</td>';
                    html +='<td>'+row.adult_num+'</td>';
                    html +='<td>'+row.adult_price+'</td>';
                    html +='<td>'+row.child_num+'</td>';
                    html +='<td>'+row.child_price+'</td>';
                    html +='<td>'+row.total_price+'</td>';
                    html +='<td>'+row.remark+'</td>';
                    html +='<td>';
                    html +='    <lqf_link><a class="ajax-open" data-url="{:url(\'TmGuideReceipt/edit\')}"  data-ids="{\'id\':\''+row.id+'\'}" data-title="修改" data-calback="ajaxTmOrderGuideInfoData($(\'.ajax-list-guide.receipt\'))">修改</a></lqf_link>';
                    html +='    <lqf_link><a class="ajax-del" data-url="{:url(\'TmGuideReceipt/del\')}"  data-ids="{\'id\':\''+row.id+'\'}"  data-calback="ajaxTmOrderGuideInfoData($(\'.ajax-list-guide.receipt\'))">删除</a></lqf_link>';
                    html +='</td>';
                    html +='</tr>';
                    break;
                case 'paid':
                    html +='<tr>';
                    html +='<td>'+row.guide_name+'</td>';
                    html +='<td>'+row.item_name+'</td>';
                    html +='<td>'+row.money+'</td>';
                    html +='<td>'+row.remark+'</td>';
                    html +='<td>';
                    html +='    <lqf_link><a class="ajax-open" data-url="{:url(\'TmGuidePaid/edit\')}"  data-ids="{\'id\':\''+row.id+'\'}" data-title="修改" data-calback="ajaxTmOrderGuideInfoData($(\'.ajax-list-guide.paid\'))">修改</a></lqf_link>';
                    html +='    <lqf_link><a class="ajax-del" data-url="{:url(\'TmGuidePaid/del\')}"  data-ids="{\'id\':\''+row.id+'\'}"  data-calback="ajaxTmOrderGuideInfoData($(\'.ajax-list-guide.paid\'))">删除</a></lqf_link>';
                    html +='</td>';
                    html +='</tr>';
                    break;
                case 'coll':
                    html +='<tr>';
                    html +='<td>'+row.guide_name+'</td>';
                    html +='<td>'+row.item_name+'</td>';
                    html +='<td>'+row.money+'</td>';
                    html +='<td>'+row.remark+'</td>';
                    html +='<td>';
                    html +='    <lqf_link><a class="ajax-open" data-url="{:url(\'TmGuideColl/edit\')}"  data-ids="{\'id\':\''+row.id+'\'}" data-title="修改" data-calback="ajaxTmOrderGuideInfoData($(\'.ajax-list-guide.coll\'))">修改</a></lqf_link>';
                    html +='    <lqf_link><a class="ajax-del" data-url="{:url(\'TmGuideColl/del\')}"  data-ids="{\'id\':\''+row.id+'\'}"  data-calback="ajaxTmOrderGuideInfoData($(\'.ajax-list-guide.coll\'))">删除</a></lqf_link>';
                    html +='</td>';
                    html +='</tr>';
                    break;
                default:
                    html="";
            }

        });

        return html
    }



</script>